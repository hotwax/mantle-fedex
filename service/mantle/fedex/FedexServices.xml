<?xml version="1.0" encoding="UTF-8"?>
<services xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="http://moqui.org/xsd/service-definition-2.1.xsd">
    
        <service verb="send" noun="FedexRequest">
            <in-parameters>
                <parameter name="requestMap" required="true"/>
                <parameter name="apiToken" required="true"/>
            </in-parameters>
            <out-parameters>
                <parameter name="responseMap"/>
            </out-parameters>
            <actions>
                <log message="======================================${requestMap}=============="/>
                <set field="connectUrl" value="https://apis-sandbox.fedex.com/address/v1/addresses/resolve"/>
                <script><![CDATA[
                  import org.moqui.util.RestClient;
                  import groovy.json.JsonSlurper;

                     def connectUrl=connectUrl;
                     RestClient restClient = ec.service.rest()
                     restClient.method("POST")
                     restClient.uri(connectUrl)
                     restClient.contentType("application/json")
                     restClient.addHeader("Authorization", "Bearer ${apiToken}")
                     restClient.addHeader("Content-Type", "application/json")
                     restClient.jsonObject(requestMap)
                     RestClient.RestResponse restResponse = restClient.call()

                     /*Checking Response Code is not verified yet*/
                     if (restResponse.statusCode < 200 || restResponse.statusCode > 300) {
                        errMsgMap = (Map) new JsonSlurper().parseText(restResponse.text())
                        ec.logger.warn(restResponse.text())
                        return responseMap
                    }

                    /*Storing response of API in responseMap*/
                    responseMap = restResponse.jsonObject()
            ]]></script>
            <log message="==========================================${responseMap}=============="/>
            </actions>
        </service>
</services>
